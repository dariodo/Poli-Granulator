/* Knob Skin
   
   DOM structure:
       .knob-face
         .inset
           .chamfer
             .face
               .arrow
               .inner
   
   Rotation controlled via --rot CSS variable set by mountKnobs()
*/

/* Skin Variables */
:root{
  --knob-size: 97px;

  /* Outer ring tint */
  --knob-tint-h: 200;
  --knob-tint-s: 63%;

  /* Shadows */
  --knob-shadow-outer: 0 6px 10px hsla(0, 0%, 0%, 0.50);
  --knob-shadow-inset: inset 0 -3px 5px hsla(0, 0%, 100%, 0.10);
  --chamfer-shadow-outer: 0 6px 10px hsla(0, 0%, 0%, 0.5);
  --chamfer-shadow-inset: inset 0 -3px 3px hsla(0, 0%, 100%, 0.06);

  /* Fallback rotation */
  --rot: -135deg;
}

/* Knob Container */
.knob-face{
  width: var(--knob-size);
  height: var(--knob-size);
  border: 0;
  background: none;
  display: grid;
  place-items: center;
  position: relative;
  border-radius: 50%;
  transition: none;
}

/* Visual Stack */

/* Outer inset ring */
.knob-face .inset{
  width: 100%;
  height: 100%;
  border-radius: 50%;
  
  box-shadow: var(--knob-shadow-inset);
  position: relative;
  display: grid;
  place-items: center;
  background-color: var(--inset-base);
  background-image: linear-gradient(
    to bottom,
    var(--inset-top),
    var(--inset-bottom)
  );
  transition:
    --inset-base   var(--theme-transition),
    --inset-top    var(--theme-transition),
    --inset-bottom var(--theme-transition);
}


/* Chamfer ring */
.knob-face .chamfer{
  width: 82%;
  height: 82%;
  border-radius: 50%;
  background-color: hsl(0, 0%, 8%);
  background-image: linear-gradient(to bottom, hsl(0, 0%, 22%), hsl(0, 0%, 8%));
  box-shadow: var(--chamfer-shadow-outer), var(--chamfer-shadow-inset);
  position: relative;
  display: grid;
  place-items: center;
}

/* Knob face (rotates) */
.knob-face .face{
  width: 87%;
  height: 87%;
  border-radius: 50%;
  background-color: hsl(0, 0%, 16%);
  box-shadow: inset 0 2px 2px hsla(0, 0%, 60%, 0.08);
  transform: rotate(var(--rot));
  transform-origin: 50% 50%;
  position: relative;
  will-change: transform;
  transition: transform 200ms cubic-bezier(.22,.61,.36,1);
}

/* Arrow indicator */
.knob-face .face .arrow{
  width: 0; height: 0;
  position: relative;
  top:  calc(0.13 * var(--knob-size));
  left: calc(0.13 * var(--knob-size));
  border-top:   calc(0.065 * var(--knob-size)) solid hsl(0, 0%, 70%);
  border-right: calc(0.065 * var(--knob-size)) solid transparent;
}

/* Inner indicator */
.knob-face .face .inner{
  position: relative;
  display: block;
  z-index: 2;
  width:  calc(0.15 * var(--knob-size));
  height: calc(0.15 * var(--knob-size));
  top:  calc(0.1 * var(--knob-size));
  left: calc(0.16 * var(--knob-size));
  background-color: hsl(0, 0%, 35%);
  background-image: linear-gradient(to bottom, hsl(0, 0%, 19%), hsl(0, 0%, 33%));
  border-radius: 50%;
}

/* Zero Mark (clickable snap to center) */
.params .col .zero-mark{
  position: absolute;
  left: 50%;
  top: 0.1px;
  transform: translateX(-50%) translateY(-12%) rotate(180deg);
  width: 0; height: 0;
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  border-bottom: 6px solid var(--panel-bg);
  border-radius: 999999999px;
  box-shadow: none;
  pointer-events: auto;
  z-index: 4;
  cursor: pointer;
  transition: border-bottom-color var(--theme-transition), transform 90ms ease, opacity 120ms ease;
}
.params .col .zero-mark:active{
  transform: translateX(-50%) rotate(180deg) scale(.94);
  opacity: .85;
}

/* Invisible Input Range Overlay */
.params .col input.param-slider{
  -webkit-appearance: none;
  appearance: none;
  position: absolute;
  top: -6px;
  left: 50%;
  transform: translateX(-50%);
  width: calc(var(--knob-size) + 12px);
  height: calc(var(--knob-size) + 12px);
  opacity: 0;
  cursor: ew-resize;
  background: transparent;
  outline: none;
  z-index: 3;
}
.params .col input.param-slider:focus{
  outline: none;
}

/* Numeric Keycaps (keyboard shortcuts 1-0) */
:root{
  --keycap-font: "Share Tech Mono", ui-monospace, monospace;
  --keycap-h: 16px;
  --keycap-minw: 18px;
  --keycap-ink: #e9e9e9;
  --keycap-ink-dim: #cfcfcf;
}

.params .col[data-key]{ position: relative; }

/* Hidden by default */
.params .col[data-key]::after{
  content: attr(data-key);
  position: absolute;
  left: 50%;
  top: -10px;
  transform: translate(-50%, 350%);
  min-width: var(--keycap-minw);
  height: var(--keycap-h);
  padding: 0 6px;
  display: grid;
  place-items: center;
  font: 600 11px/1 var(--keycap-font);
  letter-spacing: .2px;
  color: var(--keycap-ink);
  background: transparent;
  border-radius: 6px;
  border: transparent;
  pointer-events: none;
  user-select: none;
  filter: brightness(10);
  opacity: 0;
  visibility: hidden;
  transition: opacity .16s ease;
}

/* Visible when info overlay is shown */
.granular-ui.keycaps-on .params .col[data-key]::after{
  opacity: .92;
  visibility: visible;
}

/* Variant: numbers inside the knob */
.granular-ui.keycaps-inside .params .col[data-key]::after{
  top: 28px;
  transform: translate(-50%, 100%);
  color: var(--keycap-ink-dim);
  opacity: .85;
}

/* Feedback when key is pressed */
.params .col.keycap-pressed::after{ opacity: 1; }
