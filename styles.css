/* Poli-Granulator Main Styles */

/* Root Variables */
:root{
  /* Panel palette */
  --panel-bg: #000000;
  --rail-grey: #D8D8D8;
  --ink: #0B0B0B;
  --tick: #1f1f1f;
  --shadow: 0 10px 24px rgba(0,0,0,.18), 0 4px 10px rgba(0,0,0,.12);

  /* Panel theme */
  
  --theme-transition: 300ms cubic-bezier(.2,0,0,1);

  /* Switch/Fader sizing */
  --switch-scale: 0.33;
  --fader-h: 160px;
  --fader-w: 64px;
  --ticks-shift: -2px;
  --tick-gap: 10px;
  --tick-thickness: 1px;

  /* Wave window */
  --wave-h: 280px;
  --wave-pad: 5px;
  --wave-radius: 6px;

  /* Params grid */
  --gap-x: 16px;
  --plate-inner-top: 1px;

  /* Side rail */
  --rail-w: 135px;
  --screw-size: 16px;
  --screw-offset: 10px;
  --rail-text-light: #98ffa6a3;
  --rail-text-glow: rgba(0,0,0,.65);

  /* UI fonts */
  --ui-font: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  --seven-seg: "Digital7Mono", "Share Tech Mono", monospace;

  /* I/O icons */
  --io-icon-size: 16px;
  --io-icon-color: hsl(0 0% 88%);
  --io-icon-opacity: 0.80;

  /* Splash overlay */
  --splash-bg: rgba(0,0,0,.36);
  --splash-blur: 6px;
  --splash-dur: 500ms;
  --splash-ease: cubic-bezier(.3, 1.8, .3, .9);

  /* Steel palette */
  --steel-base: rgb(31 31 31);
  --steel-1000: rgb(21, 21, 21);
  --steel-900:  rgb(33, 33, 33);
  --steel-800:  rgb(78, 77, 77);
  --steel-700:  rgb(108, 108, 108);
  --steel-600:  rgb(120, 119, 119);
  --specular-hi: rgba(255,255,255,.27);

  /* CRT effect */
  --crt-scanlines-opacity: .92;
  --crt-flicker-amp: .15;
  --crt-refresh-speed: 5s;
  --crt-curvature: 1;

  /* Bezels */
  --wave-bezel-pad: 13px;
  --tri-bezel-pad: 3px;
  --rail-bezel-pad: 9px;
  --rail-h: 618px;
  --rail-radius: 0px;

  /* Keyboard press effect */
  --kbd-press-bw: 2px;
  --kbd-press-radius: 0px;
  --kbd-press-outset: 2px;
}

/* Oklab steel colors when supported */
@supports (color: color-mix(in oklab, white 50%, black 50%)){
  :root{
    --steel-1000: color-mix(in oklab, var(--steel-base) 90%, rgb(111, 111, 111) 90%);
    --steel-900:  color-mix(in oklab, var(--steel-base) 90%, rgb(109, 109, 109) 20%);
    --steel-800:  color-mix(in oklab, var(--steel-base) 80%, white 100%);
    --steel-700:  color-mix(in oklab, var(--steel-base) 78%, white 100%);
    --steel-600:  color-mix(in oklab, var(--steel-base) 68%, white 100%);
  }
}

/* Cursor themes */
.granular-ui[data-cursor="a"]{
  --panel-bg: #899f8c;
  --inset-base: hsl(129 10% 43%);
  --inset-top: hsl(129 10% 53%);
  --inset-bottom: hsl(129 10% 60%);
  --plate-glow: 0 0 0 2px rgba(255,255,255,.22);
}
.granular-ui[data-cursor="b"]{
  --panel-bg: #829aa6;
  --inset-base: hsl(200 17% 43%);
  --inset-top: hsl(200 17% 53%);
  --inset-bottom: hsl(200 17% 60%);
  --plate-glow: 0 0 0 2px rgba(29,53,87,.22);
}
.granular-ui[data-cursor="c"]{
  --panel-bg: #a68282;
  --inset-base: hsl(0, 17%, 43%);
  --inset-top: hsl(0 17% 53%);
  --inset-bottom: hsl(0 17% 60%);
  --plate-glow: 0 0 0 2px rgba(126,64,139,.22);
}

/* Fonts - only those actually used */
@font-face{
  font-family:"JetBrains Mono";
  src: url("/assets/fonts/JetBrains_Mono/static/JetBrainsMono-Regular.ttf") format("truetype");
  font-weight: 400; font-style: normal; font-display: swap;
}
@font-face{
  font-family:"JetBrains Mono";
  src: url("/assets/fonts/JetBrains_Mono/static/JetBrainsMono-SemiBold.ttf") format("truetype");
  font-weight: 600; font-style: normal; font-display: swap;
}
@font-face{
  font-family: "Digital7Mono";
  src: url("/assets/fonts/digital_7/digital-7 (mono).ttf") format("truetype");
  font-weight: 400; font-style: normal; font-display: swap;
}

/* Base layout */
body{
  margin:0;
  font-family: var(--ui-font);
  color: var(--ink);
  background:
    radial-gradient(circle at 1px 1px, #cfcfcf55 1.2px, transparent 1.2px) 0 0/28px 28px,
    #ffffff;
  overflow: auto;
  display: flex;
  align-items: center;
  justify-content: flex-start;
  min-height: 100dvh;
}

.granular-ui{
  position: relative; z-index:1;
  width: 900px; max-width: 1050px; height: 665px;
  margin: 28px auto;
  display: grid; grid-template-columns: 1fr var(--rail-w);
  background: var(--panel-bg);
  border: 6px solid transparent; border-radius: 10px;
  box-shadow: var(--shadow);
  overflow: visible;
  transition: background-color var(--theme-transition);
  padding-right: 18px;
  padding-bottom: 28px;
}

.center-pane{
  position: relative;
  display: grid; grid-template-rows: auto auto auto; gap: 10px;
  max-width: 94%; padding: 18px;
}

/* Wave window */
.wave-window{
  position: relative; display: grid;
  width: 700px;
  padding: var(--wave-pad);
  height: calc(var(--wave-h) + 2 * var(--wave-pad));
  background: #000000;
  border-radius: 10px;
  overflow: hidden;
  margin-top: -7px;
  isolation: isolate;
  box-shadow:
    inset 0 0 calc(80px * var(--crt-curvature)) rgba(0,0,0,.6),
    inset 0 0 calc(50px * var(--crt-curvature)) rgba(0,0,0,.45),
    inset 0 0 12px rgba(255,255,255,.05);
  transform: translateZ(0);
  z-index: 9999 !important;
}

.wave-window canvas,
#waveformCanvas{
  display:block;
  width: 100%;
  height: var(--wave-h);
  background: transparent;
  border-radius: clamp(0px, calc(var(--wave-radius) - var(--wave-pad)), 40px);
  transform-origin: 50% 50%;
  transform: scaleY(var(--wave-zoom-y, 0.95));
  z-index: 0;
  filter: url(#glassBulgePinned);
}

/* CRT overlays */
.fx-overlay{
  position:absolute; inset:0; pointer-events:none; z-index: 5;
}
.crt-scanlines{
  background: repeating-linear-gradient(to bottom,
    rgba(0,255,0,.07) 0px, rgba(0,255,0,.07) 1px,
    rgba(0,0,0,0) 3px, rgba(0,0,0,0) 4px);
  mix-blend-mode: normal;
  opacity: var(--crt-scanlines-opacity);
  animation: crt-scan-roll 12s linear infinite;
}
@keyframes crt-scan-roll{ from{background-position-y:0;} to{background-position-y:8px;} }

.crt-aperture{
  background: repeating-linear-gradient(to right,
    rgba(255,0,0,.35) 0 1px, rgba(0,255,0,.668) 1px 2px,
    rgba(0,0,255,.35) 2px 3px, transparent 3px 6px);
  mix-blend-mode: normal;
  opacity: .18;
}

.crt-flicker{
  background: linear-gradient(to bottom,
    rgba(0,255,0,0) 0%, rgba(0,255,0,.06) 48%,
    rgba(0,255,0,0) 52%) center top/100% 20% no-repeat;
  animation:
    crt-refresh var(--crt-refresh-speed) linear infinite,
    crt-flicker 60ms steps(2, end) infinite;
  mix-blend-mode: screen;
  opacity:.995;
}
@keyframes crt-refresh{ 0%{background-position-y:-20%;} 100%{background-position-y:120%;} }
@keyframes crt-flicker{
  0%{filter:brightness(calc(1 - var(--crt-flicker-amp)));}
  100%{filter:brightness(calc(1 + var(--crt-flicker-amp)));}
}

/* Glass bulge effect */
.wave-window::before{
  content:""; position:absolute; inset:8px; border-radius:6px; pointer-events:none;
  background: radial-gradient(420% 400% at 50% 50%, rgba(0,0,0,.35) 90%, rgba(0,0,0,0) 92%);
  mix-blend-mode: multiply;
  opacity:.95;
}
.wave-window::after{
  content:""; position:absolute; inset:-14% -6%; pointer-events:none;
  background:
    linear-gradient(72deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.22) 12%, rgba(255,255,255,0) 18%) center/200% 200% no-repeat,
    radial-gradient(130% 95% at 50% -8%, rgba(255,255,255,.22) 0%, rgba(255,255,255,0) 60%) top/100% 55% no-repeat,
    radial-gradient(120% 90% at 50% 112%, rgba(255,255,255,.12) 0%, rgba(255,255,255,0) 55%) bottom/100% 40% no-repeat,
    radial-gradient(160% 120% at 0% 50%, rgba(255,255,255,.06), rgba(255,255,255,0) 60%) left/55% 100% no-repeat,
    radial-gradient(160% 120% at 100% 50%, rgba(255,255,255,.06), rgba(255,255,255,0) 60%) right/55% 100% no-repeat;
  filter: blur(.8px);
  mix-blend-mode: screen;
  opacity:.9;
  z-index: 9999;
}

/* Wave bezel */
.wave-bezel{
  width: 700px;
  padding: var(--wave-bezel-pad);
  border-radius: 8px;
  background-color: var(--inset-base);
  background-image: linear-gradient(to bottom, var(--inset-top), var(--inset-bottom));
  box-shadow: var(--knob-shadow-inset);
  transition:
    --inset-base var(--theme-transition),
    --inset-top var(--theme-transition),
    --inset-bottom var(--theme-transition);
  display: grid;
  place-items: stretch;
}
.wave-bezel > .wave-window{
  width: 100% !important;
  margin: 0;
  border-radius: var(--wave-radius, 10px);
}

/* Tools bar */
.tools-bar{
  display: grid; grid-template-columns: auto auto auto;
  align-items: center; gap: 80px;
  margin-top: -4px; width: 685px; padding: 4px 0;
  margin-left: 10px;
}
.tools-group{ display:flex; align-items:center; gap:10px; }

/* Params/knobs grid */
.params{
  position: relative; z-index:1; width: 685px;
  margin-left: 10px;
  display:grid; grid-template-columns: repeat(6, minmax(0, 1fr));
  grid-template-rows: repeat(2, auto);
  column-gap: var(--gap-x); row-gap: 10px;
  align-items: start; justify-items: center; padding-top: var(--plate-inner-top);
}
.params .col{
  position: relative; min-width: 0;
  display:grid; grid-template-rows: auto auto; justify-items:center; gap: 6px;
}
.params .col input.keep-slider{ position: static; width: 100%; height: 10px; opacity: 1; cursor: pointer; }
.params .col label{ font-size: 11px; line-height: 1.15; font-weight: 600; color: rgba(255, 255, 255, 0.6); text-align: center; }

/* Sliders */
.param-slider{ width: 100%; -webkit-appearance:none; appearance:none; height:6px; background:#1a1a1a; border-radius:999px; outline:none; box-shadow: inset 0 0 0 2px #2b2b2b; }
.param-slider::-webkit-slider-thumb{ -webkit-appearance:none; width:18px; height:18px; border-radius:50%; background: var(--rail-grey); border:2px solid var(--ink); box-shadow: 0 2px 4px rgba(0,0,0,.35); cursor:pointer; }
.param-slider::-moz-range-thumb{ width:18px; height:18px; border-radius:50%; background: var(--rail-grey); border:2px solid var(--ink); box-shadow: 0 2px 4px rgba(0,0,0,.35); cursor:pointer; }
.vertical-label{ font-size: 11px; margin-top: -9px; text-align:center; color: #fff; opacity: 0.55; text-shadow: 0 1px 0 var(--rail-text-glow); font-family: var(--ui-font); font-weight: 200;}

/* Side rail */
.side-rail{
  position: relative; isolation:isolate;
  width: 85%; height: 610px;
  display:grid; grid-template-rows: auto auto auto 1fr auto; justify-items: center !important; gap:12px;
  padding: calc(var(--screw-offset) + var(--screw-size) + 8px) max(calc(var(--screw-offset) + var(--screw-size) + 8px), 16px) !important;
  background: transparent !important; border-radius:10px;
  margin-top: 18.5px; margin-right: 18px;
  border: #18181835 .5px solid;
  --rivet-size: 8px;
  --rivet-inset: 8px;
}
.side-rail::before{
  content:""; position:absolute; inset:0; border-radius:6px; z-index:0; pointer-events:none;
  background:
    radial-gradient(1px 1px at 12% 22%, rgba(255,255,255,.045) 0 1px, transparent 1.2px) repeat,
    radial-gradient(1px 1px at 68% 32%, color-mix(in oklab, var(--steel-600), transparent 70%) 0 1px, transparent 1.2px) repeat,
    radial-gradient(1px 1px at 30% 78%, rgba(255,255,255,.035) 0 1px, transparent 1.2px) repeat,
    radial-gradient(160% 90% at 50% 18%, rgba(255,255,255,.10) 0%, rgba(255,255,255,.06) 36%, transparent 72%),
    linear-gradient(180deg, var(--steel-800) 0%, var(--steel-1000) 100%),
    radial-gradient(140% 120% at 50% 50%, transparent 0 60%, color-mix(in oklab, var(--steel-900), transparent 35%) 100%);
  background-blend-mode: normal, normal, normal, screen, normal, multiply;
}
.side-rail > *{ position:relative; z-index:2; }

/* dB meters */
.dbmeters{
  display:grid; grid-auto-flow:column; align-items:center !important; justify-items: center !important;
  justify-content: center !important; column-gap:12px; background:none; border:none; padding:0; margin:0;
  --led-size:14px; --led-gap:6px;
  --green:#78ff6f; --green-core:#d6ffd8;
  --amber:#ffd56d; --amber-core:#fff1b6;
  --red:#ff6b6b; --red-core:#ffcaca;
}
.dbmeters .meter{ list-style:none; margin:0; padding:0; display:grid; row-gap:var(--led-gap); align-content:center; justify-items:center; }
.dbmeters .led{
  width:var(--led-size); height:var(--led-size); border-radius:50%; border:1px solid #0c1015;
  background: radial-gradient(36% 36% at 38% 34%, rgba(255,255,255,.26), rgba(255,255,255,0) 60%),
    radial-gradient(circle at 50% 60%, #0d1116 0 58%, #0a0d12 62% 100%);
  box-shadow: inset 0 1px 2px rgba(255,255,255,.05), 0 1px 0 rgba(255,255,255,.06);
}
.dbmeters .led.on[data-color="green"]{
  background: radial-gradient(36% 36% at 38% 34%, rgba(255,255,255,.55), rgba(255,255,255,0) 60%),
    radial-gradient(circle at 50% 60%, var(--green-core) 0 22%, var(--green) 40%, #1b741b 78%);
  border-color:#3a9b3a;
  box-shadow: 0 0 12px 5px rgba(120,255,111,.5), inset 0 0 8px rgba(255,255,255,.22), 0 1px 0 rgba(255,255,255,.25);
}
.dbmeters .led.on[data-color="amber"]{
  background: radial-gradient(36% 36% at 38% 34%, rgba(255,255,255,.55), rgba(255,255,255,0) 60%),
    radial-gradient(circle at 50% 60%, var(--amber-core) 0 22%, var(--amber) 40%, #8f6e18 78%);
  border-color:#b58928;
  box-shadow: 0 0 12px 5px rgba(255,208,87,.5), inset 0 0 8px rgba(255,255,255,.22), 0 1px 0 rgba(255,255,255,.25);
}
.dbmeters .led.on[data-color="red"]{
  background: radial-gradient(36% 36% at 38% 34%, rgba(255,255,255,.55), rgba(255,255,255,0) 60%),
    radial-gradient(circle at 50% 60%, var(--red-core) 0 22%, var(--red) 40%, #7a1212 78%);
  border-color:#9a2e2e;
  box-shadow: 0 0 14px 6px rgba(255,75,75,.58), inset 0 0 8px rgba(255,255,255,.22), 0 1px 0 rgba(255,255,255,.25);
}

/* Play/Rec 3D switch */
.switch-wrap{ --local-switch-scale: var(--switch-scale); width: calc(150px * var(--local-switch-scale)); height: calc(195px * var(--local-switch-scale)); display:grid; place-items: center; }
.switch-wrap > .switch{ transform: scale(var(--local-switch-scale)) !important; transform-origin: center left !important; margin: -70px 0 0 0 !important; }
.switch{ display:inline-block; background-color:black; width:150px; height:195px; box-shadow: 0 0 10px 2px rgba(0,0,0,.2), 0 0 1px 2px black, inset 0 2px 2px -2px white, inset 0 0 2px 15px #47434c, inset 0 0 2px 22px black; border-radius:5px; padding:20px; perspective:700px; margin:10px; }
.switch input{ display:none; }
.switch .button{ display:block; transition: all .3s cubic-bezier(1,0,1,1); transform-origin:center center -20px; transform: translateZ(20px) rotateX(-25deg); transform-style: preserve-3d; background-color:#9b0621; height:100%; position:relative; cursor:pointer; background: linear-gradient(#980000 0%, #6f0000 30%, #6f0000 70%, #980000 100%) no-repeat; }
.switch input:checked + .button{ transform: translateZ(20px) rotateX(25deg); }
.switch .button::before{ content:""; background: linear-gradient(rgba(255,255,255,.8) 10%, rgba(255,255,255,.3) 30%, #650000 75%, #320000) 50% 50%/97% 97%, #b10000 no-repeat; width:100%; height:50px; transform-origin: top; transform: rotateX(-90deg); position:absolute; top:0; }
.switch .button::after{ content:""; background-image: linear-gradient(#650000, #320000); width:100%; height:50px; transform-origin: top; transform: translateY(50px) rotateX(-90deg); position:absolute; bottom:0; box-shadow: 0 50px 8px 0px black, 0 80px 20px 0px rgba(0,0,0,.5); }
.switch .light{ opacity:0; animation: light-off 1s; position:absolute; inset:0; background-image: radial-gradient(#ffc97e, #ff1818 40%, transparent 70%); }
.switch .dots{ position:absolute; inset:0; background-image: radial-gradient(transparent 30%, rgba(101,0,0,.7) 70%); background-size:10px 10px; }
.switch .characters{ position:absolute; inset:0; pointer-events:none; }
.switch .characters::before{ position:absolute; left:58px; top:18px; transform: translateX(-50%); font-family: var(--ui-font); font-weight:200; letter-spacing:.28em; font-size:28px; line-height:1; text-transform:uppercase; color: #ffffff; text-shadow: 0 1px 0 var(--rail-text-glow), 0 0 6px rgba(255,255,255,.18); opacity:.65; content:""; }
.switch .shine{ transition: all .3s cubic-bezier(1,0,1,1); opacity:.3; position:absolute; inset:0; background: linear-gradient(white, transparent 3%) 50% 50%/97% 97%, linear-gradient(rgba(255,255,255,.5), transparent 50%, transparent 80%, rgba(255,255,255,.5)) 50% 50%/97% 97% no-repeat; }
.switch .shadow{ transition: all .3s cubic-bezier(1,0,1,1); opacity:1; position:absolute; inset:0; background: linear-gradient(transparent 70%, rgba(0,0,0,.8)) no-repeat; }
@keyframes flicker{ 0%{opacity:1;} 80%{opacity:.8;} 100%{opacity:1;} }
@keyframes light-off{ 0%{opacity:1;} 80%{opacity:0;} }
.switch--rec input:checked + .button{ box-shadow: 0 -10px 20px #ff1818; }
.switch--rec input:checked + .button .light{ animation: flicker .2s infinite .3s; }
.switch--rec input:checked + .button .shine{ opacity:1; }
.switch--rec input:checked + .button .shadow{ opacity:0; }
.switch--rec .light{ background-image: radial-gradient(#ffc97e, #ff1818 40%, transparent 70%); }
.switch--rec .characters::before{ content:"REC"; }
.switch--play input:checked + .button{ box-shadow: 0 -10px 22px rgba(255,255,255,.95); }
.switch--play input:checked + .button .light{ animation: flicker .2s infinite .3s; }
.switch--play input:checked + .button .shine{ opacity:1; }
.switch--play input:checked + .button .shadow{ opacity:0; }
.switch--play .light{ background-image: radial-gradient(#ffffff, rgba(255,255,255,.85) 40%, transparent 70%); }
.switch--play .characters::before{ content:"PLAY"; letter-spacing:.24em; }
.switch--play .button{ background-color:#2b2b2f; background: linear-gradient(#4a4850 0%, #2c2b30 30%, #1a1a1e 70%, #35343c 100%) no-repeat; }
.switch--play .button::before{ background: linear-gradient(rgba(255,255,255,.25) 10%, rgba(255,255,255,.08) 30%, #1b1b1f 75%, #070709) 50% 50%/97% 97%, #2f2e35 no-repeat; }
.switch--play .button::after{ background-image: linear-gradient(#1b1b1f, #060608); }
.switch--play .dots{ background-image: radial-gradient(transparent 30%, rgba(0,0,0,.6) 70%); }
.switch input:checked + .button .light{ animation: flicker .12s infinite 0s; }
.switch .light{ animation: light-off .4s; }

/* Time display */
.time-display{
  font-variant-numeric: tabular-nums; font-size: 9px; color: var(--rail-text-light);
  text-shadow: 0 1px 0 var(--rail-text-glow); font-family: var(--seven-seg); font-weight: 200;
  border: 1px solid rgb(0, 0, 0); border-radius: 2px; padding: 2px 4px;
  background: rgb(0, 0, 0); box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.447);
  margin-top: -8px; margin-bottom: 10px; justify-self: center !important;
}

/* Split button (Load/Mic/Hold/Reset) */
.io-split-btn{
  display:inline-flex; align-items:center; justify-content:center; width:380px !important; height:32px;
  background:hsl(0, 0%, 16%); border:2px solid #0f0f0f; border-radius:8px;
  box-shadow: inset 0 0 0 1px #2b2b2b, 0 2px 4px rgba(0,0,0,.35);
  overflow:hidden; position: relative;
}
.io-half{
  flex:1; display:grid; place-items:center; height:100%; color:#fff;
  cursor:pointer; user-select:none;
  transition: filter .15s ease, transform .06s ease, background-color .18s ease;
  position:relative; background:transparent;
}
.io-half:focus-visible{ outline:2px solid #7ed3ff; outline-offset:-2px; }
.io-split-btn .io-half + .io-half{ border-left:1px solid #000; box-shadow: inset 1px 0 0 #2b2b2b; }

/* Split button icons */
.io-icon{
  --icon-url: none;
  width: var(--io-icon-size); height: var(--io-icon-size);
  display: inline-block;
  background-color: var(--io-icon-color);
  opacity: var(--io-icon-opacity);
  -webkit-mask: var(--icon-url) center / contain no-repeat;
          mask: var(--icon-url) center / contain no-repeat;
}
.icon-load  { --icon-url: url("assets/icons/load_icon.png"); }
.icon-mic   { --icon-url: url("assets/icons/mic_icon.png"); }
.icon-reset { --icon-url: url("assets/icons/reset_icon.png"); }
.icon-hold  { --icon-url: url("assets/icons/hold_icon.png"); width: 20px; height: 19px; }

.io-load:hover{ filter: brightness(1.06); }
.io-load:active{ transform: translateY(1px) scale(.99); }

/* Keyboard press effects */
.io-load, .io-reset, .io-mic{
  transition: filter .15s ease, transform .06s ease, background-color .18s ease;
}
.io-load.kbd-press,
.io-reset.kbd-press,
.io-mic.kbd-press:not(.is-armed):not(.is-recording){
  filter: brightness(1.06);
  transform: translateY(1px) scale(.99);
}
.io-half.kbd-press::after{
  content:""; position:absolute;
  inset: calc(-1 * var(--kbd-press-outset));
  pointer-events:none; z-index: 3;
  background: transparent;
  border-top: var(--kbd-press-bw) solid rgb(0, 0, 0);
  border-left: var(--kbd-press-bw) solid rgb(0, 0, 0);
  border-bottom: var(--kbd-press-bw) solid rgb(84, 84, 84);
  border-right: var(--kbd-press-bw) solid rgb(84, 84, 84);
  border-radius: 0;
}
.io-split-btn .io-half.kbd-press:first-child::after{
  border-top-left-radius: calc(var(--kbd-press-radius) + var(--kbd-press-outset));
  border-bottom-left-radius: calc(var(--kbd-press-radius) + var(--kbd-press-outset));
}
.io-split-btn .io-half.kbd-press:last-child::after{
  border-top-right-radius: calc(var(--kbd-press-radius) + var(--kbd-press-outset));
  border-bottom-right-radius: calc(var(--kbd-press-radius) + var(--kbd-press-outset));
}

/* Hold toggle */
.io-hold.is-on,
.io-hold[aria-pressed="true"]{
  background: transparent; box-shadow: none; filter: none;
}
.io-hold.is-on::after,
.io-hold[aria-pressed="true"]::after{
  content:""; position:absolute;
  inset: calc(-1 * var(--kbd-press-outset));
  pointer-events:none; z-index: 3;
  background: transparent;
  border-top: var(--kbd-press-bw) solid rgb(0, 0, 0);
  border-left: var(--kbd-press-bw) solid rgb(0, 0, 0);
  border-bottom: var(--kbd-press-bw) solid rgb(84, 84, 84);
  border-right: var(--kbd-press-bw) solid rgb(84, 84, 84);
}
.io-hold.is-on .io-icon,
.io-hold[aria-pressed="true"] .io-icon{
  background-color: var(--io-icon-color);
  opacity: var(--io-icon-opacity);
}

.io-reset:hover{ filter: brightness(1.06); }
.io-reset:active{ transform: translateY(1px) scale(.99); }
.io-reset:focus-visible{ outline:2px solid #7ed3ff; outline-offset:-2px; }

/* Mic states */
.mic-led{ position:absolute; top:6px; right:6px; width:8px; height:8px; border-radius:50%; background:#2a2a2a; box-shadow: inset 0 0 2px #000; }
.io-mic.is-armed{ background:#2a1616; }
.io-mic.is-recording{ background:#D02121; filter: brightness(1.05) drop-shadow(0 0 10px rgba(208,33,33,.45)); }
.io-mic.is-recording .mic-led{ background:#e74c3c; box-shadow: 0 0 8px #e74c3c99, inset 0 0 2px #fff6; animation: micPulse 1s ease-in-out infinite; }
.io-mic:not(.is-armed):not(.is-recording):hover{ filter: brightness(1.06); }
.io-mic:not(.is-armed):not(.is-recording):active{ transform: translateY(1px) scale(.99); }
@keyframes micPulse{ 0%,100%{opacity:.9;transform:scale(1);} 50%{opacity:1;transform:scale(1.22);} }
@media (prefers-reduced-motion: reduce){ .io-mic.is-recording .mic-led{ animation:none; } }

/* Info button */
.io-round-btn{
  width:23px; height:23px; border-radius:9px;
  display:inline-grid; place-items:center;
  background:#0000; border:1px solid #0000008c;
  box-shadow: inset 0 0 0 1px #2b2b2b, 0 2px 4px rgba(0,0,0,.35);
  color:#fff; cursor:pointer; user-select:none;
  transition: filter .15s ease, transform .06s ease, background-color .18s ease;
  transform: translateX(77px) !important;
}
.io-round-btn:hover{ filter: brightness(1.06); }
.io-round-btn:active{ transform: translateY(1px) scale(.99); }
.io-round-btn.io-unload{
  transform: translateX(4px);
  width:23px; height:23px; border-radius:50%;
  border: transparent;
  box-shadow: inset 2px 2px 4px rgba(212,211,211,0), inset -1px -1px 0 rgba(255,255,255,0);
  color:#fff;
}
.io-round-glyph{
  font: italic 700 19px/1 Georgia, "Times New Roman", serif;
  color:#fff; letter-spacing:0;
  text-shadow: -0.5px -0.5px 0 rgba(0,0,0,.55), 0.5px 0.5px 0 rgba(255,255,255,.30);
  transition: text-shadow .18s ease, filter .18s ease;
  pointer-events:none;
}
.io-round-btn.kbd-press, .io-round-btn:active{ filter: brightness(1.06); }
.io-round-btn.io-unload:active .io-round-glyph,
.io-round-btn.io-unload.kbd-press .io-round-glyph{
  text-shadow:
    0 0 4px rgba(255,255,255,.90),
    0 0 9px rgba(255,255,255,.80),
    -0.5px -0.5px 0 rgba(0,0,0,.55),
    0.5px 0.5px 0 rgba(255,255,255,.30);
}

/* Master fader */
.fader{
  position:relative; width: var(--fader-w); height: var(--fader-h);
  background:transparent !important; box-shadow:none !important;
  padding-top:6px; border-radius:9px; justify-self: center !important;
}
.ticks-col{ position:absolute; top: calc(10px + var(--ticks-shift)); bottom: calc(10px - var(--ticks-shift)); pointer-events:none; }
.ticks-col.left{ left:3px; }
.ticks-col.right{ right:3px; }
.ticks-col.minor{ width:12px; background: repeating-linear-gradient(to bottom, transparent 0 var(--tick-gap), transparent var(--tick-gap), rgba(255, 255, 255, 0.419) var(--tick-gap) calc(var(--tick-gap) + var(--tick-thickness))); }
.slot{ position:absolute; top:6%; bottom:6%; left:50%; transform:translateX(-50%); width:10px; background:#000; border-radius:8px; }
.thumb{
  --w:56px; --h:28px;
  position:absolute; left:50%; transform: translate(-50%, -50%);
  width:var(--w); height:var(--h); display:block; border-radius:2px; border:1px solid #111;
  cursor:grab; outline:none; -webkit-tap-highlight-color:transparent;
  background: linear-gradient(to bottom,#222222 0px,#171717 9px,#272727 10px,#000000 11px,#ffffff 13px,#1d1d1d 15px,#1a1a1a 16px,#212121 40px);
  box-shadow: 0 2px 10px rgba(0,0,0,.5), 0 0 2px rgba(120, 120, 120, 0.287) inset;
}
.thumb:active{ cursor:grabbing; }
#masterThumb, #masterThumb:focus, #masterThumb:focus-visible{
  outline: 0 !important; -webkit-appearance: none; appearance: none;
  box-shadow: 0 2px 10px rgba(0,0,0,.5), 0 0 2px rgba(255,255,255,0.1) inset !important;
}
#masterThumb:-moz-focusring{ outline: 0; }
#masterThumb::-moz-focus-inner{ border: 0; }
#masterThumb{ -webkit-tap-highlight-color: transparent; cursor: -webkit-grab; cursor: grab; }
#masterThumb:active{ cursor: -webkit-grabbing; cursor: grabbing; }
#masterThumb:focus:not(:focus-visible){ outline: 0 !important; }

/* Wave splash overlay */
.wave-splash{
  position:absolute; inset: var(--wave-pad); display:grid; place-items:center;
  border-radius:4px; pointer-events:none; opacity:0; transform: scale(.985); z-index:4;
  transition: opacity var(--splash-dur) var(--splash-ease), transform var(--splash-dur) var(--splash-ease);
  background: var(--splash-bg);
  -webkit-backdrop-filter: blur(var(--splash-blur)) saturate(1.04);
          backdrop-filter: blur(var(--splash-blur)) saturate(1.04);
}
.wave-splash.is-visible{ opacity:1; transform: scale(1); }
.wave-splash.is-visible .splash-card{ transform: translateY(-150px) scale(1); }
.wave-splash .splash-visual{ width: min(60%, 380px); aspect-ratio: 2.6 / 1; }
.wave-splash .splash-card{
  height:150px; width:650px; margin-top:2px; padding:8px; border-radius:10px;
  text-align:center; align-items:center;
  transform: scale(.985);
  transition: opacity var(--splash-dur) var(--splash-ease), transform var(--splash-dur) var(--splash-ease);
  font-size:10px; font-weight:600; letter-spacing:.2px; color:rgb(255, 255, 255, 0.60);
}
.wave-splash .splash-text{
  column-count:1; font-size:11px; font-family: var(--seven-seg);
  row-gap:2px; column-fill: balance; text-align:justify; hyphens:auto;
  color: rgba(255, 255, 255, 0.7);
}
.wave-splash.no-anim, .wave-splash.no-anim *{ transition: none !important; animation: none !important; }

/* Background animation canvas */
.bg-anim-canvas{
  position: fixed; inset: 0;
  width: 100vw; height: 100vh;
  display: block; pointer-events: none; z-index: 0;
}

/* Tri-switch */
.slide-switch3{
  --w:96px; --h:28px; --pad:2px; --thumb:30px; --rad:1px; --steps:2;
  --travel: calc(var(--w) - var(--thumb) - (var(--pad) * 2));
  --step: calc(var(--travel) / var(--steps)); --pos:0;
  position:relative; display:inline-block; width:var(--w); height:var(--h);
  padding:var(--pad); border:none; background:none;
  cursor:pointer; appearance:none; outline:none;
  -webkit-tap-highlight-color: transparent; user-select:none; touch-action:none;
}
.slide-switch3 .rail{
  position:absolute; inset:var(--pad); border-radius: var(--rad);
  background: radial-gradient(180% 120% at 50% -30%, rgba(255,255,255,.07) 0 35%, rgba(0,0,0,0) 36%),
    linear-gradient(180deg, #171717 0%, #101010 100%);
  box-shadow: inset 0 .5px 0 rgba(255,255,255,.12), inset 0 -.5px 0 rgba(0,0,0,.85), 0 0 0 1px #000;
}
.slide-switch3 .thumb{
  position:absolute; top:var(--pad); left:var(--pad);
  width:var(--thumb); height: calc(var(--h) - var(--pad) * 2);
  border-radius: var(--rad);
  transform: translateX(calc(var(--pos) * var(--step))) translateZ(0);
  will-change: transform, box-shadow;
  backface-visibility:hidden; contain: paint;
  background: repeating-linear-gradient(90deg, #3e3e3e 0 3px, #2a2a2a 3px 6px),
    linear-gradient(180deg, #474747, #272727);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.16), inset 0 -1px 0 rgba(0,0,0,.75),
    0 1px 0 rgba(0,0,0,.65), 0 2px 8px rgba(0,0,0,.6);
  transition: transform .16s cubic-bezier(.2,.8,.2,1);
}
.slide-switch3 .thumb::before{
  content:""; position:absolute; inset:0; border-radius: var(--rad);
  background: linear-gradient(90deg, rgba(255,255,255,.10), rgba(255,255,255,0) 18%, rgba(255,255,255,0) 82%, rgba(0,0,0,.20));
  pointer-events:none;
}
.slide-switch3 .thumb::after{
  content:""; position:absolute; inset:2px 4px; border-radius: calc(var(--rad) - 1px);
  background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,0) 40%, rgba(0,0,0,0) 60%, rgba(0,0,0,.25));
  mix-blend-mode: screen; pointer-events:none;
}
.slide-switch3.dragging .thumb, .slide-switch3.no-anim .thumb{ transition:none; }
.slide-switch3:active .thumb{
  box-shadow: inset 0 1px 0 rgba(255,255,255,.16), inset 0 -1px 0 rgba(0,0,0,.75),
    0 1px 0 rgba(0,0,0,.65), 0 2px 8px rgba(0,0,0,.6);
}
.slide-switch3:focus-visible .rail{ outline:2px solid #7ed3ff; outline-offset:2px; }
.slide-switch3[disabled], .slide-switch3[aria-disabled="true"]{ cursor:not-allowed; opacity:.75; filter: grayscale(.25); }
@media (prefers-reduced-motion: reduce){ .slide-switch3 .thumb{ transition:none; } }

/* Tri-switch bezel */
.tri-bezel{
  display: inline-grid; place-items: center;
  padding: var(--tri-bezel-pad);
  border-radius: calc(var(--rad, 1px) + var(--tri-bezel-pad));
  background-color: var(--inset-base);
  background-image: linear-gradient(to bottom, var(--inset-top), var(--inset-bottom));
  box-shadow: var(--knob-shadow-inset);
  transition:
    --inset-base var(--theme-transition),
    --inset-top var(--theme-transition),
    --inset-bottom var(--theme-transition);
}
.tri-bezel > .slide-switch3{ margin: 0; }

/* Side-rail bezel */
.rail-bezel{
  width: 100%; height: var(--rail-h);
  padding: var(--rail-bezel-pad);
  border-radius: calc(var(--rail-radius) + var(--rail-bezel-pad));
  background-color: var(--inset-base);
  background-image: linear-gradient(to bottom, var(--inset-top), var(--inset-bottom));
  box-shadow: var(--knob-shadow-inset);
  transition:
    --inset-base var(--theme-transition),
    --inset-top var(--theme-transition),
    --inset-bottom var(--theme-transition);
  display: grid; place-items: stretch;
  margin-top: 17.7px;
}
.rail-bezel > .side-rail{
  width: 100% !important;
  height: calc(var(--rail-h) - 2 * var(--rail-bezel-pad));
  margin: 0 !important; border-radius: 9px;
  padding-inline: 14px !important;
  place-items: start center !important;
}

/* Rivets */
.rivet{
  position:absolute;
  inline-size: var(--rivet-size, 10px);
  block-size: var(--rivet-size, 10px);
  border-radius:50%;
  background:
    radial-gradient(circle at 35% 30%, var(--specular-hi) 0 18%, transparent 19%),
    radial-gradient(70% 70% at 60% 65%,
      color-mix(in oklab, var(--steel-700), transparent 10%) 20%,
      color-mix(in oklab, var(--steel-800), transparent 5%) 70%,
      var(--steel-900) 100%),
    linear-gradient(145deg, var(--steel-600), var(--steel-700));
  box-shadow:
    0 0 0 1px color-mix(in oklab, var(--steel-900), transparent 10%),
    0 0 0 2px rgba(255,255,255,.08),
    inset 2px 2px 4px rgba(255,255,255,.12),
    inset -3px -3px 6px color-mix(in oklab, var(--steel-900), transparent 10%);
}
.side-rail .rivet--left{ left: var(--rivet-inset); top:50%; transform: translateY(-50%); }
.side-rail .rivet--right{ right: var(--rivet-inset); top:50%; transform: translateY(-50%); }
.side-rail .rivet--tl{ top: var(--rivet-inset); left: var(--rivet-inset); }
.side-rail .rivet--tr{ top: var(--rivet-inset); right: var(--rivet-inset); }
.side-rail .rivet--bl{ bottom: var(--rivet-inset); left: var(--rivet-inset); }
.side-rail .rivet--br{ bottom: var(--rivet-inset); right: var(--rivet-inset); }

/* Scratches overlay */
.scratches{ position: absolute; inset: 0; pointer-events: none; z-index: 0; }
.scratches > span{
  --x: 50%; --y: 50%; --len: 80px; --rot: 0deg;
  position: absolute; left: var(--x); top: var(--y);
  width: var(--len); height: 1px;
  transform: translate(-50%,-50%) rotate(var(--rot));
  background: linear-gradient(90deg,
    transparent 0, rgba(255,255,255,.22) 45%,
    rgba(255,255,255,.33) 50%, rgba(255,255,255,.22) 55%, transparent 100%);
  box-shadow:
    0 1px 0 color-mix(in oklab, var(--steel-1000), transparent 35%),
    0 -1px 0 color-mix(in oklab, var(--steel-900), transparent 40%);
  filter: drop-shadow(0 0 .6px rgba(255,255,255,.22));
  opacity: .55;
}
.scratches > span::before,
.scratches > span::after{
  content:""; position:absolute; inset:0;
  background: linear-gradient(90deg,
    transparent 0, color-mix(in oklab, var(--steel-600), white 15%) 47%,
    color-mix(in oklab, var(--steel-600), white 5%) 50%,
    color-mix(in oklab, var(--steel-600), white 15%) 53%, transparent 100%);
  opacity:.55; transform: translateY(.6px);
}
.scratches > span::after{ transform: translateY(-.6px); opacity:.28; }

/* Accessibility/focus */
.granular-ui :focus, .granular-ui :focus-visible{ outline:none !important; box-shadow:none !important; }
button::-moz-focus-inner{ border:0; }

/* Typography */
.small{ font-size: 10px; color:#ffffff79; margin-top: -2px; font-family: var(--ui-font); font-weight: 200; }
.col{ display:flex; flex-direction:column; gap:8px; }
.center{ display:grid; place-items:center; }
